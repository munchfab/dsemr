---
# title: "Template Title"
# author: "Your Name"
# date: "The Date"
output: pdf_document
documentclass: standalone
classoption:
  tikz=true
header-includes: 
  - \usepackage{tikz}
  - \usepackage{pgfplots}
  - \pgfplotsset{compat=1.18}
  - \usetikzlibrary{shapes, positioning, calc, decorations.markings, chains, scopes}
  - \newlength{\Radius}
  - \setlength\Radius{4em}
  - \usepackage{amsmath}
  - \usepackage{caption}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
\begin{tikzpicture}[
    auto, > = latex, align=center,
  	latent/.style = {
  	  circle, draw, thick, inner sep = 2pt, minimum width = \Radius
  	},
  	manifest/.style = {
  	  rectangle, draw, thick, inner sep = 0pt, minimum size = \Radius/2
  	},
  	intercept/.style = {
  	  regular polygon,regular polygon sides = 3, draw, thick,
  	  inner sep = 0pt, minimum size = \Radius
  	},
  	mean/.style = {
  	  regular polygon, regular polygon sides = 3, draw, thick,
  	  inner sep = 0pt, minimum size = 8mm
  	},
  	path/.style = {
  	  arrows = ->, thick, > = {stealth[]}
  	},
  	error/.style = {
  	  circle, draw = none, fill = none, thick,
  	  inner sep = 0pt, minimum size = 5mm
  	},
  	var/.style = {
  	  <->, thick, > = {stealth[]}, bend right = 270, looseness = 2
  	},
  	cov/.style = {
  	  <->, thick, > = {stealth[]}, bend right = 300
  	},
  	% style to add a circle in the middle of a path
    random/.style = {
      postaction = {
        decorate, decoration = {
          markings,
          mark = at position .5 with {
            \draw[fill = black] circle[radius = 2pt];
          }
        }
      }
    },
    random_cl/.style = {
      postaction = {decorate, decoration = {
        markings,
        mark = at position .2 with {
          \draw[fill = black] circle[radius = 2pt];}
        }
      }
    },
  	]
% draw within-level structural model
      \node  [latent]  (y1wt-1)  {$y_{1,t-1}^w$};
      \node  [latent]  (y1wt)  [right = 5em of y1wt-1]  {$y_{1,t}^w$};
      \node  [latent]  (delta1t)  [right = 2.5em of y1wt]  {$\delta_{1,t}$};

      \foreach \i [remember = \i as \lasti (initially 1)] in {2, ..., 3}
      \node  [latent]  (y1wt-\i)  [left = 5em of y1wt-\lasti]  {$y_{1,t-\i}^w$};

      % draw paths
      \draw  [path]  (delta1t)  to node  []  {}  (y1wt);
      
\draw  [path, postaction = random]  (y1wt-1)  to node  []  {$\phi_{11;(1)}$}  (y1wt);
\draw  [path, postaction = random]  (y1wt-2)  to node  []  {$\phi_{11;(1)}$}  (y1wt-1);
\draw  [path, postaction = random]  (y1wt-3)  to node  []  {$\phi_{11;(1)}$}  (y1wt-2);
\draw  [path, postaction = random]  (y1wt-2.north)  |-  +(0em, 1em) -|  node  []  {$\phi_{11;(2)}$}  (y1wt.north);
\draw  [path, postaction = random]  (y1wt-3.north)  |-  +(0em, 2em) -|  node  []  {$\phi_{11;(3)}$}  (y1wt.north);
\draw  [var, postaction = random]  (delta1t.120)  to node  []  {$\pi_{1}$}  (delta1t.60);

% caption
\node  [above = 1em, align = center]  at  (current bounding box.north)  {Within-model.};
\end{tikzpicture}
